<div class="app-color-gen-form__snapshots">
  @let noMoreSnapshots = snapshots().length >= maxSnapshots;

  @if (hasSelectedSnapshot()) {
    <button
      type="button"
      aria-label="Remove selected snapshot"
      matTooltip="Remove selected snapshot"
      matTooltipPosition="above"
      mat-icon-button
      (click)="removeSelectedSnapshot()"
    >
      <mat-icon>delete</mat-icon>
    </button>
  } @else {
    <button
      type="button"
      aria-label="Take a snapshot"
      matTooltip="Take a snapshot"
      matTooltipPosition="above"
      mat-icon-button
      [disabled]="this.form.invalid || noMoreSnapshots"
      (click)="takeSnapshot()"
    >
      <mat-icon>{{ noMoreSnapshots ? 'no_photography' : 'add_a_photo' }}</mat-icon>
    </button>
  }

  @for (snapshot of snapshots(); track $index) {
    @if (snapshot.value === formValueSnapshot()) {
      <button type="button" mat-flat-button (click)="applySnapshot(snapshot.value)">{{ snapshot.alias }}</button>
    } @else {
      <button type="button" mat-button (click)="applySnapshot(snapshot.value)">{{ snapshot.alias }}</button>
    }
  }
</div>

<form [formGroup]="form" class="app-color-gen-form__form">
  <mat-form-field appearance="outline" style="width: 11rem">
    <mat-label>Color in hexadecimal</mat-label>
    <input [formControl]="form.controls.color" matInput />
    <mat-error>Invalid</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" style="width: 6rem">
    <mat-label>Start</mat-label>
    <input [formControl]="form.controls.start" matInput type="number" min="0" max="100" />
    <mat-error>Invalid</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" style="width: 6rem">
    <mat-label>End</mat-label>
    <input [formControl]="form.controls.end" matInput type="number" min="0" max="100" />
    <mat-error>Invalid</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" style="width: 11rem">
    <mat-label>Easing</mat-label>
    <mat-select [formControl]="form.controls.easing">
      @for (name of easingFuncNames; track name) {
        <mat-option [value]="name">{{ name }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-checkbox [formControl]="form.controls.reverse" class="app-color-gen-form__align">Reverse</mat-checkbox>

  <mat-checkbox [formControl]="form.controls.neutral" class="app-color-gen-form__align">Neutral</mat-checkbox>

  <app-color-gen-bezier [formControl]="form.controls.cubicBezier" [canvasSize]="200" [lineColor]="css.rgbColor()" />
  <app-css-var-observer cssVarName="--mat-sys-on-surface" #css="appCssVarObserver" />

  <button
    type="button"
    mat-icon-button
    aria-label="Settings"
    class="app-color-gen-form__align"
    (click)="openSettings()"
  >
    <mat-icon>settings</mat-icon>
  </button>
</form>

<ng-template #settingsTemplate>
  <div role="heading" aria-level="2" mat-dialog-title>Settings</div>

  <mat-dialog-content>
    <mat-form-field appearance="outline" style="margin-top: 0.25rem; width: 100%">
      <mat-label>JSON</mat-label>
      <textarea
        [formControl]="settingsCtrl"
        rows="3"
        cdkTextareaAutosize
        cdkAutosizeMaxRows="14"
        matInput
        (focus)="settingsElement.select()"
        #settingsElement
      ></textarea>
      <mat-error>Invalid settings</mat-error>
    </mat-form-field>
  </mat-dialog-content>

  <mat-dialog-actions>
    <button mat-button mat-dialog-close>Close</button>
    <button mat-flat-button [disabled]="!settingsCtrl.value" (click)="applySettings()">Apply</button>
  </mat-dialog-actions>
</ng-template>
